<!doctype html>
<html lang="es" class="h-full antialiased">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EmprendeCR · Tareas</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><circle cx=%2250%22 cy=%2250%22 r=%2245%22 fill=%22%231d4ed8%22/></svg>">
  <style>
    .glass { backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); background: rgba(255,255,255,.7); }
    @media (prefers-color-scheme: dark){ .glass { background: rgba(17,24,39,.6);} }
  </style>
</head>
<body class="h-full bg-gradient-to-br from-blue-50 via-white to-red-50 dark:from-slate-900 dark:via-slate-900 dark:to-slate-900 text-slate-800 dark:text-slate-100">

  <!-- HEADER -->
  <header class="fixed inset-x-0 top-0 z-50 flex items-center justify-between px-4 sm:px-6 py-3">
    <div class="flex items-center gap-3">
      <button id="menuBtn" class="lg:hidden rounded-lg p-2 border border-slate-300/60 dark:border-slate-600/60" aria-label="Abrir menú">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M3 6h18M3 12h18M3 18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
      </button>
      <img src="zLogoEmprendeCR.png" alt="EmprendeCR" class="h-10 sm:h-12 w-auto select-none pointer-events-none">
      <span class="text-lg sm:text-xl font-semibold tracking-tight">EmprendeCR</span>
    </div>
    <div class="flex items-center gap-2">
      <button id="openNewBtn" class="hidden sm:inline-flex rounded-lg px-3 py-2 text-sm font-medium bg-blue-600 text-white hover:bg-blue-700">+ Nueva tarea</button>
      <button id="modeBtn" class="rounded-full px-3 py-1 text-xs font-medium border border-slate-300/60 text-slate-700 hover:bg-white dark:text-slate-200 dark:border-slate-600/60 dark:hover:bg-slate-800">
        Modo oscuro
      </button>
    </div>
  </header>

  <!-- LAYOUT -->
  <div class="pt-20 grid grid-cols-1 lg:grid-cols-[260px,1fr] gap-4">

    <!-- SIDEBAR -->
    <aside id="sidebar" class="lg:sticky lg:top-20 lg:h-[calc(100vh-5rem)] lg:block hidden px-4 sm:px-6">
      <nav class="glass rounded-2xl p-4 ring-1 ring-white/50 dark:ring-white/10">
        <p class="px-3 pb-2 text-xs uppercase tracking-wider text-slate-500 dark:text-slate-400">Menú</p>
        <ul class="space-y-1 text-sm">
          <li><a class="flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-white/60 dark:hover:bg-slate-800/60" href="Menu.html"><span>🏠</span>Dashboard</a></li>
          <li><a class="flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-white/60 dark:hover:bg-slate-800/60" href="Insumos.html">📦 Insumos</a></li>
          <li><a class="flex items-center gap-3 px-3 py-2 rounded-xl bg-blue-600/10 text-blue-700 dark:text-blue-300" href="Tareas.html">✅ Tareas</a></li>
          <li><a class="flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-white/60 dark:hover:bg-slate-800/60" href="Calendario.html">🗓️ Calendario / Gantt</a></li>
          <li><a class="flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-white/60 dark:hover:bg-slate-800/60" href="Capacitaciones.html">🎓 Capacitaciones</a></li>
          <li><a class="flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-white/60 dark:hover:bg-slate-800/60" href="Entidades.html">🏛️ Entidades</a></li>
          <li><a class="flex items-center gap-3 px-3 py-2 rounded-xl hover:bg-white/60 dark:hover:bg-slate-800/60" href="Requisitos.html">📑 Requisitos / Docs</a></li>
          <li><a class="flex items-center gap-3 px-6 py-2 rounded-xl hover:bg-white/60 dark:hover:bg-slate-800/60" href="Presupuesto.html">₡ Presupuesto</a></li>
        </ul>
      </nav>
    </aside>

    <!-- CONTENIDO -->
    <main class="px-4 sm:px-6 pb-14">
      <div class="max-w-7xl mx-auto space-y-6">

        <!-- Título + acciones -->
        <div class="flex flex-col md:flex-row md:items-end md:justify-between gap-3">
          <div>
            <h1 class="text-2xl sm:text-3xl font-bold tracking-tight">Tareas</h1>
            <p class="text-slate-600 dark:text-slate-300">Plan diario y seguimiento por estado, prioridad y fecha.</p>
          </div>
          <div class="flex gap-2">
            <button id="switchList" class="rounded-xl border border-slate-300/70 px-3 py-2 text-sm hover:bg-white dark:border-slate-600/70 dark:hover:bg-slate-800">Vista lista</button>
            <button id="switchKanban" class="rounded-xl border border-slate-300/70 px-3 py-2 text-sm hover:bg-white dark:border-slate-600/70 dark:hover:bg-slate-800">Vista Kanban</button>
            <button id="openNewBtnTop" class="rounded-xl bg-blue-600 text-white px-3 py-2 text-sm font-semibold hover:bg-blue-700">+ Nueva tarea</button>
          </div>
        </div>

        <!-- Filtros -->
        <section class="glass rounded-2xl p-4 ring-1 ring-white/50 dark:ring-white/10">
          <div class="flex flex-col lg:flex-row gap-3 lg:items-center lg:justify-between">
            <div class="flex-1 flex gap-2">
              <div class="relative flex-1">
                <input id="searchInput" type="text" class="w-full rounded-xl border border-slate-300/70 bg-white/80 px-4 py-2.5 pl-10 text-sm dark:bg-slate-800/80 dark:border-slate-600" placeholder="Buscar por título, área o responsable">
                <svg class="absolute left-3 top-2.5" width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M21 21l-4.3-4.3M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
              </div>
              <select id="filterEstado" class="rounded-xl border border-slate-300/70 bg-white/80 px-3 py-2.5 text-sm dark:bg-slate-800/80 dark:border-slate-600">
                <option value="">Todos los estados</option>
                <option>Pendiente</option>
                <option>En progreso</option>
                <option>Hecha</option>
              </select>
              <select id="filterPrio" class="rounded-xl border border-slate-300/70 bg-white/80 px-3 py-2.5 text-sm dark:bg-slate-800/80 dark:border-slate-600">
                <option value="">Cualquier prioridad</option>
                <option>Alta</option>
                <option>Media</option>
                <option>Baja</option>
              </select>
              <select id="filterFecha" class="rounded-xl border border-slate-300/70 bg-white/80 px-3 py-2.5 text-sm dark:bg-slate-800/80 dark:border-slate-600">
                <option value="">Todas las fechas</option>
                <option>Hoy</option>
                <option>Esta semana</option>
                <option>Este mes</option>
              </select>
            </div>
            <div class="flex gap-2">
              <button id="btnLimpiar" class="rounded-xl px-3 py-2 text-sm border border-slate-300/70 hover:bg-white dark:border-slate-600/70 dark:hover:bg-slate-800">Limpiar</button>
            </div>
          </div>
        </section>

        <!-- LISTA -->
        <section id="listaView" class="glass rounded-2xl ring-1 ring-white/50 dark:ring-white/10 overflow-hidden">
          <div class="overflow-x-auto">
            <table class="min-w-full text-sm">
              <thead class="bg-slate-100/70 dark:bg-slate-800/60 text-slate-700 dark:text-slate-200">
                <tr>
                  <th class="text-left px-4 py-3">Tarea</th>
                  <th class="text-left px-4 py-3">Área</th>
                  <th class="text-left px-4 py-3">Responsable</th>
                  <th class="text-left px-4 py-3">Estado</th>
                  <th class="text-left px-4 py-3">Prioridad</th>
                  <th class="text-right px-4 py-3">Vence</th>
                  <th class="text-right px-4 py-3">Acciones</th>
                </tr>
              </thead>
              <tbody id="tbodyTareas" class="divide-y divide-slate-200/70 dark:divide-slate-700/60">
                <tr>
                  <td class="px-4 py-3 font-medium">Definir insumos críticos</td>
                  <td class="px-4 py-3">Insumos</td>
                  <td class="px-4 py-3">Andrea</td>
                  <td class="px-4 py-3"><span class="text-xs px-2 py-1 rounded-full bg-amber-600/15 text-amber-700 dark:text-amber-300">En progreso</span></td>
                  <td class="px-4 py-3"><span class="text-xs px-2 py-1 rounded-full bg-blue-600/15 text-blue-700 dark:text-blue-300">Alta</span></td>
                  <td class="px-4 py-3 text-right">Hoy 4:00 p. m.</td>
                  <td class="px-4 py-3 text-right">
                    <button class="text-blue-700 dark:text-blue-300 hover:underline mr-2">Editar</button>
                    <button class="text-slate-500 hover:underline">Completar</button>
                  </td>
                </tr>
                <tr>
                  <td class="px-4 py-3 font-medium">Revisión de prototipo UI</td>
                  <td class="px-4 py-3">Diseño</td>
                  <td class="px-4 py-3">Andre</td>
                  <td class="px-4 py-3"><span class="text-xs px-2 py-1 rounded-full bg-slate-600/10 text-slate-700 dark:text-slate-300">Pendiente</span></td>
                  <td class="px-4 py-3"><span class="text-xs px-2 py-1 rounded-full bg-emerald-600/15 text-emerald-700 dark:text-emerald-300">Media</span></td>
                  <td class="px-4 py-3 text-right">Mañana</td>
                  <td class="px-4 py-3 text-right">
                    <button class="text-blue-700 dark:text-blue-300 hover:underline mr-2">Editar</button>
                    <button class="text-slate-500 hover:underline">Completar</button>
                  </td>
                </tr>
                <tr>
                  <td class="px-4 py-3 font-medium">Cargar plan a Gantt</td>
                  <td class="px-4 py-3">Proyecto</td>
                  <td class="px-4 py-3">Equipo</td>
                  <td class="px-4 py-3"><span class="text-xs px-2 py-1 rounded-full bg-emerald-600/15 text-emerald-700 dark:text-emerald-300">Hecha</span></td>
                  <td class="px-4 py-3"><span class="text-xs px-2 py-1 rounded-full bg-amber-600/15 text-amber-700 dark:text-amber-300">Baja</span></td>
                  <td class="px-4 py-3 text-right">Ayer</td>
                  <td class="px-4 py-3 text-right">
                    <button class="text-blue-700 dark:text-blue-300 hover:underline mr-2">Editar</button>
                    <button class="text-slate-500 hover:underline">Reabrir</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="flex items-center justify-between px-4 py-3 border-t border-slate-200/70 dark:border-slate-700/60 text-sm">
            <p id="countInfo">3 tareas</p>
            <div class="flex gap-2">
              <button class="rounded-lg px-3 py-1 border border-slate-300/70 hover:bg-white dark:border-slate-600/70 dark:hover:bg-slate-800">Anterior</button>
              <button class="rounded-lg px-3 py-1 border border-slate-300/70 hover:bg-white dark:border-slate-600/70 dark:hover:bg-slate-800">Siguiente</button>
            </div>
          </div>
        </section>

        <!-- KANBAN -->
        <section id="kanbanView" class="hidden">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <!-- Pendiente -->
            <div class="glass rounded-2xl p-4 ring-1 ring-white/50 dark:ring-white/10">
              <h3 class="text-sm font-semibold mb-3">Pendiente</h3>
              <div id="colPendiente" class="space-y-3">
                <article class="rounded-xl p-4 bg-white/70 dark:bg-slate-800/70 ring-1 ring-slate-200/60 dark:ring-slate-700/60">
                  <p class="font-medium">Revisión de prototipo UI</p>
                  <p class="text-xs text-slate-500">Diseño · Mañana · Prioridad Media</p>
                </article>
              </div>
            </div>
            <!-- En progreso -->
            <div class="glass rounded-2xl p-4 ring-1 ring-white/50 dark:ring-white/10">
              <h3 class="text-sm font-semibold mb-3">En progreso</h3>
              <div id="colProgreso" class="space-y-3">
                <article class="rounded-xl p-4 bg-white/70 dark:bg-slate-800/70 ring-1 ring-slate-200/60 dark:ring-slate-700/60">
                  <p class="font-medium">Definir insumos críticos</p>
                  <p class="text-xs text-slate-500">Insumos · Hoy 4:00 p. m. · Prioridad Alta</p>
                </article>
              </div>
            </div>
            <!-- Hecha -->
            <div class="glass rounded-2xl p-4 ring-1 ring-white/50 dark:ring-white/10">
              <h3 class="text-sm font-semibold mb-3">Hecha</h3>
              <div id="colHecha" class="space-y-3">
                <article class="rounded-xl p-4 bg-white/70 dark:bg-slate-800/70 ring-1 ring-slate-200/60 dark:ring-slate-700/60">
                  <p class="font-medium">Cargar plan a Gantt</p>
                  <p class="text-xs text-slate-500">Proyecto · Ayer · Prioridad Baja</p>
                </article>
              </div>
            </div>
          </div>
        </section>

      </div>
    </main>
  </div>

  <!-- MODAL NUEVA TAREA -->
  <div id="modalNew" class="fixed inset-0 z-[60] hidden">
    <div class="absolute inset-0 bg-slate-900/50"></div>
    <div class="relative mx-auto mt-24 w-[92%] max-w-xl">
      <div class="glass rounded-2xl p-6 ring-1 ring-white/50 dark:ring-white/10">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold">Nueva tarea</h3>
          <button id="closeNew" class="rounded-lg px-2 py-1 border border-slate-300/70 dark:border-slate-600/70">✕</button>
        </div>
        <form id="formNew" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div class="sm:col-span-2">
            <label class="text-sm">Título</label>
            <input id="tTitulo" class="mt-1 w-full rounded-xl border border-slate-300/70 bg-white/80 px-3 py-2 text-sm dark:bg-slate-800/80 dark:border-slate-600" required>
          </div>
          <div>
            <label class="text-sm">Área</label>
            <select id="tArea" class="mt-1 w-full rounded-xl border border-slate-300/70 bg-white/80 px-3 py-2 text-sm dark:bg-slate-800/80 dark:border-slate-600">
              <option>Proyecto</option>
              <option>Insumos</option>
              <option>Diseño</option>
              <option>Finanzas</option>
            </select>
          </div>
          <div>
            <label class="text-sm">Prioridad</label>
            <select id="tPrio" class="mt-1 w-full rounded-xl border border-slate-300/70 bg-white/80 px-3 py-2 text-sm dark:bg-slate-800/80 dark:border-slate-600">
              <option>Alta</option>
              <option>Media</option>
              <option>Baja</option>
            </select>
          </div>
          <div>
            <label class="text-sm">Vence</label>
            <input id="tFecha" type="date" class="mt-1 w-full rounded-xl border border-slate-300/70 bg-white/80 px-3 py-2 text-sm dark:bg-slate-800/80 dark:border-slate-600">
          </div>
          <div>
            <label class="text-sm">Responsable</label>
            <input id="tResp" class="mt-1 w-full rounded-xl border border-slate-300/70 bg-white/80 px-3 py-2 text-sm dark:bg-slate-800/80 dark:border-slate-600" placeholder="Nombre">
          </div>
          <div class="sm:col-span-2">
            <label class="text-sm">Notas</label>
            <textarea id="tNotas" rows="3" class="mt-1 w-full rounded-xl border border-slate-300/70 bg-white/80 px-3 py-2 text-sm dark:bg-slate-800/80 dark:border-slate-600" placeholder="Detalles breves"></textarea>
          </div>
          <div class="sm:col-span-2 flex justify-end gap-2 pt-2">
            <button type="button" id="cancelNew" class="rounded-xl px-3 py-2 text-sm border border-slate-300/70 hover:bg-white dark:border-slate-600/70 dark:hover:bg-slate-800">Cancelar</button>
            <button class="rounded-xl px-3 py-2 text-sm bg-blue-600 text-white hover:bg-blue-700">Guardar</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    // Modo oscuro
    document.getElementById('modeBtn')?.addEventListener('click', () => {
      document.documentElement.classList.toggle('dark');
    });

    // Sidebar móvil
    const menuBtn = document.getElementById('menuBtn');
    const sidebar = document.getElementById('sidebar');
    menuBtn?.addEventListener('click', () => {
      sidebar.classList.toggle('hidden');
    });

    // Abrir/cerrar modal Nueva tarea
    const modal = document.getElementById('modalNew');
    const openBtns = [document.getElementById('openNewBtn'), document.getElementById('openNewBtnTop')].filter(Boolean);
    const closeBtns = [document.getElementById('closeNew'), document.getElementById('cancelNew')];
    openBtns.forEach(b => b.addEventListener('click', () => modal.classList.remove('hidden')));
    closeBtns.forEach(b => b?.addEventListener('click', () => modal.classList.add('hidden')));
    modal.addEventListener('click', (e) => { if (e.target === modal) modal.classList.add('hidden'); });

    // Toggle vistas
    const listaView = document.getElementById('listaView');
    const kanbanView = document.getElementById('kanbanView');
    document.getElementById('switchList')?.addEventListener('click', () => {
      listaView.classList.remove('hidden');
      kanbanView.classList.add('hidden');
    });
    document.getElementById('switchKanban')?.addEventListener('click', () => {
      kanbanView.classList.remove('hidden');
      listaView.classList.add('hidden');
    });

    // Filtros básicos (lista)
    const searchInput = document.getElementById('searchInput');
    const filterEstado = document.getElementById('filterEstado');
    const filterPrio = document.getElementById('filterPrio');
    const filterFecha = document.getElementById('filterFecha');
    const btnLimpiar = document.getElementById('btnLimpiar');
    const tbody = document.getElementById('tbodyTareas');
    const countInfo = document.getElementById('countInfo');

    function matchFecha(text, filtro) {
      if (!filtro) return true;
      text = text.toLowerCase();
      if (filtro === 'Hoy') return text.includes('hoy');
      if (filtro === 'Esta semana') return text.includes('mañana') || text.includes('semana');
      if (filtro === 'Este mes') return text.includes('semana') || text.includes('mes');
      return true;
    }
    function applyFilters(){
      const q = (searchInput.value || '').toLowerCase().trim();
      const est = (filterEstado.value || '').toLowerCase();
      const pr = (filterPrio.value || '').toLowerCase();
      const f = filterFecha.value || '';
      let visible = 0;
      [...tbody.querySelectorAll('tr')].forEach(tr => {
        const t = tr.innerText.toLowerCase();
        const okQ = !q || t.includes(q);
        const okE = !est || t.includes(est);
        const okP = !pr || t.includes(pr);
        const okF = matchFecha(t, f);
        const show = okQ && okE && okP && okF;
        tr.classList.toggle('hidden', !show);
        if (show) visible++;
      });
      countInfo.textContent = `${visible} tarea${visible!==1?'s':''}`;
    }
    [searchInput, filterEstado, filterPrio, filterFecha].forEach(el => el?.addEventListener('input', applyFilters));
    filterEstado?.addEventListener('change', applyFilters);
    filterPrio?.addEventListener('change', applyFilters);
    filterFecha?.addEventListener('change', applyFilters);
    btnLimpiar?.addEventListener('click', () => {
      searchInput.value = ''; filterEstado.value=''; filterPrio.value=''; filterFecha.value='';
      applyFilters();
    });

    // Guardar nueva tarea -> agrega fila (lista) y tarjeta (kanban)
    const formNew = document.getElementById('formNew');
    formNew?.addEventListener('submit', (e) => {
      e.preventDefault();
      const titulo = document.getElementById('tTitulo').value.trim();
      const area = document.getElementById('tArea').value;
      const prio = document.getElementById('tPrio').value;
      const vence = document.getElementById('tFecha').value ? new Date(document.getElementById('tFecha').value).toLocaleDateString('es-CR') : '—';
      const resp = document.getElementById('tResp').value.trim() || '—';

      // Lista
      const tr = document.createElement('tr');
      const chipPrio =
        prio === 'Alta' ? 'bg-blue-600/15 text-blue-700 dark:text-blue-300' :
        prio === 'Media' ? 'bg-emerald-600/15 text-emerald-700 dark:text-emerald-300' :
        'bg-amber-600/15 text-amber-700 dark:text-amber-300';
      tr.innerHTML = `
        <td class="px-4 py-3 font-medium">${titulo}</td>
        <td class="px-4 py-3">${area}</td>
        <td class="px-4 py-3">${resp}</td>
        <td class="px-4 py-3"><span class="text-xs px-2 py-1 rounded-full bg-slate-600/10 text-slate-700 dark:text-slate-300">Pendiente</span></td>
        <td class="px-4 py-3"><span class="text-xs px-2 py-1 rounded-full ${chipPrio}">${prio}</span></td>
        <td class="px-4 py-3 text-right">${vence}</td>
        <td class="px-4 py-3 text-right">
          <button class="text-blue-700 dark:text-blue-300 hover:underline mr-2">Editar</button>
          <button class="text-slate-500 hover:underline">Completar</button>
        </td>`;
      tbody.appendChild(tr);

      // Kanban (columna Pendiente)
      const card = document.createElement('article');
      card.className = 'rounded-xl p-4 bg-white/70 dark:bg-slate-800/70 ring-1 ring-slate-200/60 dark:ring-slate-700/60';
      card.innerHTML = `<p class="font-medium">${titulo}</p>
        <p class="text-xs text-slate-500">${area} · ${vence} · Prioridad ${prio}</p>`;
      document.getElementById('colPendiente').appendChild(card);

      // Cerrar modal y limpiar
      modal.classList.add('hidden');
      formNew.reset();
      applyFilters();
    });

    // Inicial
    applyFilters();
  </script>
</body>
</html>
